# ============================================================================
# flaresim — Lens Flare Simulator Configuration
# ============================================================================
# Format:  key = value
# Lines starting with # are comments.  Blank lines are ignored.
# Same key = value format as the bhrt3 scene files.
#
# Usage:
#   ./build/flaresim flaresim.conf
#   ./build/flaresim flaresim.conf --flare_gain 2000    # CLI override
# ============================================================================

# --- Input / Output ---------------------------------------------------------
input           = output.exr    # input EXR (must have R, G, B channels)
output          = flare_output.exr       # output EXR (original layers + flare.R/G/B)
lens            = ../lenses/doublegauss.lens # lens prescription (.lens file)

# --- Optics -----------------------------------------------------------------
fov             = 90            # horizontal field of view (degrees)
rays            = 64            # entrance pupil grid per dimension (NxN)
min_ghost       = 1e-7          # ghost pair pre-filter threshold

# --- Source extraction ------------------------------------------------------
threshold       = 1.0           # bright pixel luminance threshold
downsample      = 4             # downsample bright pixels by this factor

# --- Flare appearance -------------------------------------------------------
flare_gain      = 10000          # ghost intensity multiplier
                                #   physically correct ghosts are very dim;
                                #   1000 is a good starting point for visibility

# --- Sky brightness ---------------------------------------------------------
sky_brightness  = 0.01          # multiplier for sky background layers
                                #   requires sky.R/G/B layers in the EXR;
                                #   falls back to threshold-based scaling if absent

# --- Bloom (fiery wash-out glow) -------------------------------------------
bloom_strength  = 2.0           # 0 = off, 0.5 = subtle, 1.0 = strong, 3.0+ = on fire
bloom_radius    = 0.04          # base blur radius as fraction of image diagonal
bloom_passes    = 3             # box-blur passes (approximates Gaussian); 1-10
bloom_octaves   = 5             # multi-scale octaves; more = wider glow (1-6)
bloom_chromatic = 1             # 1 = warm chromatic shift (white→yellow→orange→red)
                                # 0 = neutral white bloom
bloom_threshold = -1            # bright-pixel cutoff for bloom; -1 = same as threshold

# --- Ghost smoothing (smooth sparse ray splats into continuous shapes) ------
ghost_blur      = 0.003         # blur radius as fraction of image diagonal
                                #   0 = off, 0.003 = subtle, 0.01 = soft, 0.02+ = very blurry
ghost_blur_passes = 3           # box-blur passes (3 ≈ Gaussian)

# --- Ghost area normalization -----------------------------------------------
ghost_normalize = 1             # 1 = per-pair defocus compensation (recommended)
                                #   boosts defocused ghost pairs so they remain visible;
                                #   essential for simpler lenses like the Cooke Triplet
max_area_boost  = 100           # cap on defocus correction factor; higher = more
                                #   boost for wildly defocused pairs (10-500 useful range)

# --- TGA output (optional) --------------------------------------------------
tga           = flare_output.tga    # composited beauty + flare, tonemapped to 8-bit
exposure      = 2.0                 # exposure multiplier for TGA
tonemap       = 1.0                 # tonemap compression: 0 = linear, 1 = heavy

# --- Debug ------------------------------------------------------------------
# debug_tga     = debug_bright.tga    # only bright pixels above threshold
